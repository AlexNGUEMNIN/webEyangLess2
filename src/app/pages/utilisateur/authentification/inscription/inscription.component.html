<div class="min-h-screen bg-gray-50 flex">


  <!-- Section droite avec formulaire -->
  <div class="w-full lg:w-1/2 flex flex-col justify-center overflow-y-auto items-center p-8 lg:p-12 scroll-invisible max-h-screen">
    <div class="w-full max-w-md">
      <!-- En-tête -->
      <div class="text-center mb-8">
        <h2 class="text-4xl font-semibold text-gray-800 mb-2 mt-20">
          @if (currentStep !==3 ) {
            <a class="w-16 h-16 rounded-full flex items-center justify-center text-white hover:bg-gray-100 transition-colors cursor-pointer"
              (click)="currentStep === 1 ? goToLogin() : previousStep()">
              <i class="fas fa-arrow-left text-xl text-appgreen"></i>
            </a>
          }
          @if (currentStep === 1) {
            <span>Inscription</span>
          }
          @if (currentStep === 2) {
            <span>Vous êtes ?</span>
          }
          @if (currentStep === 3) {
            <span>Vérification OTP</span>
          }
        </h2>
        @if (currentStep === 1) {
          <p class="text-gray-600 text-sm">
            Remplissez le formulaire pour vous créer un compte
          </p>
        }
        @if (currentStep === 3) {
          <p class="text-gray-600 text-sm">
            Regarder le code OTP qui vous a été envoyé par mail et<br>
            saisissez le dans ce champ.
          </p>
        }
      </div>

      <!-- Indicateur de progression -->
      <div class="flex justify-center mb-8">
        <div class="flex space-x-2">
          <div class="w-16 h-1 rounded-full transition-colors duration-300"
               [class.bg-teal-500]="currentStep >= 1"
               [class.bg-gray-300]="currentStep < 1">
          </div>
          <div class="w-16 h-1 rounded-full transition-colors duration-300"
               [class.bg-teal-500]="currentStep >= 2"
               [class.bg-gray-300]="currentStep < 2">
          </div>
          <div class="w-16 h-1 rounded-full transition-colors duration-300"
               [class.bg-teal-500]="currentStep >= 3"
               [class.bg-gray-300]="currentStep < 3">
          </div>
        </div>
      </div>

      <!-- Formulaire étape 1 -->
      @if (currentStep === 1) {
        <div class="space-y-4">
          <!-- Nom -->
          <div class="relative">
            <input
              type="text"
              [(ngModel)]="formData.nom"
              placeholder="Entrez votre nom"
              class="w-full px-4 py-3 bg-gray-100 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200"
            />
            <div class="absolute right-3 top-1/2 transform -translate-y-1/2">
              <svg class="w-5 h-5 text-teal-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
            </div>
          </div>

          <!-- Prénom -->
          <div class="relative">
            <input
              type="text"
              [(ngModel)]="formData.prenom"
              placeholder="Entrez votre prénom"
              class="w-full px-4 py-3 bg-gray-100 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200"
            />
            <div class="absolute right-3 top-1/2 transform -translate-y-1/2">
              <svg class="w-5 h-5 text-teal-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
            </div>
          </div>

          <!-- Téléphone -->
          <div class="relative">
            <input
              type="tel"
              [(ngModel)]="formData.telephone"
              placeholder="Entrez votre numéro de téléphone"
              class="w-full px-4 py-3 bg-gray-100 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200"
            />
            <div class="absolute right-3 top-1/2 transform -translate-y-1/2">
              <svg class="w-5 h-5 text-teal-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
              </svg>
            </div>
          </div>

          <!-- Email -->
          <div class="relative">
            <input
              type="email"
              [(ngModel)]="formData.email"
              (input)="checkIfEmailExists()"
              placeholder="Entrez votre email"
              class="w-full px-4 py-3 bg-gray-100 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200"
            />
            <div class="absolute right-3 top-1/2 transform -translate-y-1/2">
              <svg class="w-5 h-5 text-teal-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"></path>
              </svg>
            </div>
          </div>
          <div class="h-[10px] text-red-700 text-sm">
            @if (isEmailExists){
              <i class="fas fa-exclamation-circle mr-2"></i>Cet email est déjà utilisé
            }
          </div>

          <!-- Mot de passe -->
          <div class="relative">
            <input
              type="password"
              [(ngModel)]="formData.motDePasse"
              placeholder="Entrez votre mot de passe"
              class="w-full px-4 py-3 bg-gray-100 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200"
            />
            <div class="absolute right-3 top-1/2 transform -translate-y-1/2">
              <svg class="w-5 h-5 text-teal-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
              </svg>
            </div>
          </div>

          <!-- Confirmer mot de passe -->
          <div class="relative">
            <input
              type="password"
              [(ngModel)]="formData.confirmerMotDePasse"
              placeholder="Confirmer le mot de passe"
              class="w-full px-4 py-3 bg-gray-100 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200"
            />
            <div class="absolute right-3 top-1/2 transform -translate-y-1/2">
              <svg class="w-5 h-5 text-teal-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
              </svg>
            </div>
          </div>

          <!-- Bouton suivant -->
          <div class="flex flex-row justify-between">
            <span></span>
            <button class="w-16 h-16 rounded-full bg-appgreen flex items-center justify-center text-white shadow-md hover:bg-teal-600 transition-colors cursor-pointer
            disabled:bg-gray-300 disabled:cursor-not-allowed"
              (click)="nextStep()"
              [disabled]="!isStep1Valid()"
              >
              <i class="fas fa-arrow-right text-xl"></i>
            </button>
          </div>

          <!-- Liens du bas -->
          <div class="text-center mt-6">
            <p class="text-sm text-gray-600">
              Vous avez déjà un compte ?
              <button class="text-teal-500 hover:text-teal-600 font-medium"
                [routerLink]="['/login']">
                Connectez-vous
              </button>
            </p>
            <button (click)="continueAsGuest()" class="text-teal-500 hover:text-teal-600 text-sm font-medium mt-2">
              Continuer en tant qu'invité
            </button>
          </div>
        </div>
      }

      <!-- Formulaire étape 2 -->
      @if (currentStep === 2) {
        <div class="space-y-6">
          <div class="grid grid-cols-2 gap-4">
            <!-- Locataire -->
            <button
              (click)="selectUserType('locataire')"
              class="p-6 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all duration-200 flex flex-col items-center space-y-3"
              [class.ring-2]="formData.userType === 'locataire'"
              [class.ring-teal-500]="formData.userType === 'locataire'"
              [class.bg-teal-50]="formData.userType === 'locataire'"
            >
              <div class="w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center">
                <img src="assets/images/locataire.png" alt="">
              </div>
              <span class="font-medium text-gray-800">Locataire</span>
            </button>

            <!-- Bailleur -->
            <button
              (click)="selectUserType('bailleur')"
              class="p-6 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all duration-200 flex flex-col items-center space-y-3"
              [class.ring-2]="formData.userType === 'bailleur'"
              [class.ring-teal-500]="formData.userType === 'bailleur'"
              [class.bg-teal-50]="formData.userType === 'bailleur'"
            >
              <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center">
                <img src="assets/images/bailleur.png" alt="">
              </div>
              <span class="font-medium text-gray-800">Bailleur</span>
            </button>
          </div>

          <!-- Bouton suivant -->
           <div class="flex flex-row justify-between">
            <span></span>
            <button class="w-16 h-16 rounded-full bg-appgreen flex items-center justify-center text-white shadow-md hover:bg-teal-600 transition-colors cursor-pointer
            disabled:bg-gray-300 disabled:cursor-not-allowed"
              (click)="nextStep()"
              [disabled]="!isStep2Valid()"
              >
              @if (isLoadingStep2) {
                <i class="fas fa-circle-notch fa-spin text-xl animate-spin"></i>
              } @else {
                <i class="fas fa-arrow-right text-xl"></i>
              }
            </button>
          </div>
        </div>
      }

      <!-- Formulaire étape 3 -->
      @if (currentStep === 3) {
        <div class="space-y-6">
          <!-- Code OTP -->
          <div class="relative">
            <input
              type="text"
              [(ngModel)]="formData.codeOTP"
              placeholder="Saisir le code OTP"
              class="w-full px-4 py-3 bg-gray-100 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all duration-200 text-center text-lg tracking-wider"
              maxlength="6"
            />
          </div>
          <div class="h-[20px] text-sm text-red-700 text-right">
            @if(badCode){
              <i class="fas fa-exclamation-circle mr-2"></i> Mauvais code OTP
            }
          </div>

          <!-- Bouton final -->
          <button
            (click)="verifyAndRegister()"
            [disabled]="!isStep3Valid()"
            class="w-full bg-teal-500 hover:bg-teal-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200"
          >
          @if (isLoadingStep3) {
            <i class="fas fa-circle-notch fa-spin text-xl animate-spin"></i>
          }@else {
            Vérifier et s'inscrire
          }
          </button>
        </div>

        <!-- </div> -->
      }
      </div>
    </div>

    <!-- Conteneur principal -->
  <div class="relative w-1/2 hidden md:block h-screen overflow-hidden">
    <!-- Conteneur penché avec clip-path -->


    <!-- Image de fond NON penchée -->
    <div class="absolute inset-0 bg-cover bg-center"
      style="
        background-image: url('assets/images/image3.jpg');
        clip-path: polygon(60px 0, 100% 0, 100% 100%, 0 100%);
      ">
    </div>
    <div class="absolute inset-0 bg-darkgreen mix-blend-multiply opacity-80 h-screen w-full"
        style="clip-path: polygon(60px 0, 100% 0, 100% 100%, 0 100%);">
    </div>

    <!-- Contenu texte NON penché -->
    <div class="relative z-10 flex flex-col justify-center  p-12 text-white h-full text-right"
        style="clip-path: polygon(0 0, 100% 0, calc(100% - 60px) 100%, 0 100%);">
      <h1 class="text-5xl font-bold leading-tight mb-36">Eyangless</h1>
      <h2 class="text-3xl font-semibold mb-4 leading-tight ">
        Il devient plus facile de<br>
        trouver une chambre à<br>
        Eyang avec Eyangless
      </h2>
      <p class="text-lg opacity-90">
        Plus besoin de se tracasser pour trouver une<br>
        chambre à Eyang
      </p>
    </div>
  </div>
  </div>
<!-- </div> -->


@if (isAccountVerified) {
  <!-- Fond semi-transparent -->
  <div class="fixed inset-0 bg-black/20 z-50 flex items-center justify-center">
    <!-- Popup avec animation -->
    <div
      class="bg-white p-6 rounded-lg shadow-xl max-w-md w-full mx-4 transform transition-all duration-300 ease-out"
      [class]="isAccountVerified ? 'animate-fade-in-up' : ''"
    >
      <!-- Contenu du popup -->
      <div class="text-center">
        <!-- Icône de succès -->
        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
          <i class="fas fa-check text-green-600 text-xl"></i>
        </div>

        <!-- Message -->
        <h3 class="text-lg font-medium text-gray-900 mb-2">Compte vérifié avec succès !</h3>
        <p class="text-sm text-gray-500">
          Votre compte a été vérifié avec succès. Vous pouvez maintenant accéder à toutes les fonctionnalités.
        </p>

        <!-- Bouton de fermeture -->
        <div class="mt-6">
          <button
            (click)="isAccountVerified = false"
            class="px-4 py-2 bg-appgreen text-white rounded-md hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-colors"
          >
            Continuer
          </button>
        </div>
      </div>
    </div>
  </div>
}
